#include <msp430.h>

void main(void)
{
    WDTCTL = WDTPW | WDTHOLD;     // Stop watchdog timer

    PM5CTL0 &= ~LOCKLPM5;         // Unlock GPIO

    P1DIR |= BIT0;                // P1.0 LED output
    P1OUT &= ~BIT0;

    uart_init();

    __enable_interrupt();

    while(1) {
        __no_operation();         // Low power
    }
}

void uart_init() {
    P4SEL0 |= BIT3;
    P4SEL1 &= ~BIT3;
    P4DIR &= ~BIT3;

    P4SEL0 |= BIT2;
    P4SEL1 &= ~BIT2;
    P4DIR |= BIT2;

    UCA0CTLW0 |= UCSWRST;
    UCA0CTLW0 |= UCSSEL__SMCLK;
    UCA0BRW = 52;
    UCA0MCTLW = UCOS16 | UCBRF_1 | 0x4900;
    UCA0CTLW0 &= ~UCSWRST;
    UCA0IE |= UCRXIE;
}

#pragma vector=USCI_A0_VECTOR
__interrupt void USCI_A0_ISR(void) {
    switch (__even_in_range(UCA0IV, USCI_UART_UCTXCPTIFG))
    {
    case USCI_NONE: break;
    case USCI_UART_UCRXIFG:
        {
            unsigned char rx = UCA0RXBUF;  // Read received byte
            if (rx == 0x4F) {     // Toggle light if byte received is 0x4F
                P1OUT ^= BIT0;
            }
        }
        break;
    default: break;
    }
}

